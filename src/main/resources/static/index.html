<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKAX Physical Risk Management API - í…ŒìŠ¤íŠ¸ í˜ì´ì§€</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 0;
        }

        .sidebar {
            background: #f8f9fa;
            padding: 30px;
            border-right: 1px solid #e0e0e0;
            max-height: calc(100vh - 180px);
            overflow-y: auto;
        }

        .main {
            padding: 30px;
            max-height: calc(100vh - 180px);
            overflow-y: auto;
        }

        .auth-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .auth-section h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-badge.logged-out {
            background: #fee;
            color: #c00;
        }

        .status-badge.logged-in {
            background: #efe;
            color: #0a0;
        }

        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-bottom: 12px;
            font-size: 14px;
            font-family: inherit;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
            font-family: 'Courier New', monospace;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-size: 13px;
            font-weight: 500;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            width: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .button-secondary {
            background: #6c757d;
        }

        .button-danger {
            background: #dc3545;
        }

        .api-section {
            margin-bottom: 30px;
        }

        .api-section h3 {
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            font-size: 18px;
        }

        .api-endpoint {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
        }

        .api-endpoint h4 {
            color: #555;
            margin-bottom: 12px;
            font-size: 15px;
        }

        .method {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 700;
            margin-right: 8px;
        }

        .method.get { background: #61affe; color: white; }
        .method.post { background: #49cc90; color: white; }
        .method.put { background: #fca130; color: white; }
        .method.delete { background: #f93e3e; color: white; }

        .response {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
        }

        .response pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .token-display {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            word-break: break-all;
        }

        .user-info {
            background: #d1ecf1;
            border: 1px solid #0c5460;
            color: #0c5460;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 13px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .tab-buttons {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            flex-wrap: wrap;
        }

        .tab-button {
            background: none;
            color: #666;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            width: auto;
            font-size: 13px;
        }

        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ SKAX Physical Risk Management API</h1>
            <p>FastAPI í˜¸ì¶œ API ì „ì²´ í…ŒìŠ¤íŠ¸ ë„êµ¬ (13ê°œ ì—”ë“œí¬ì¸íŠ¸)</p>
        </div>

        <div class="content">
            <!-- ì‚¬ì´ë“œë°” -->
            <div class="sidebar">
                <div class="auth-section">
                    <h3>
                        ì¸ì¦ ìƒíƒœ
                        <span id="authStatus" class="status-badge logged-out">ë¡œê·¸ì•„ì›ƒ</span>
                    </h3>

                    <div id="loginForm">
                        <label>ì´ë©”ì¼</label>
                        <input type="email" id="loginEmail" value="test@example.com" placeholder="ì´ë©”ì¼ ì…ë ¥">

                        <label>ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="loginPassword" value="password123" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">

                        <button onclick="login()">ë¡œê·¸ì¸</button>

                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
                            <button onclick="showRegisterForm()" class="button-secondary">íšŒì›ê°€ì…</button>
                        </div>
                    </div>

                    <div id="loggedInInfo" style="display: none;">
                        <div class="user-info" id="userInfo"></div>
                        <div class="token-display" id="tokenDisplay"></div>
                        <button onclick="logout()" class="button-danger" style="margin-top: 15px;">ë¡œê·¸ì•„ì›ƒ</button>
                    </div>
                </div>

                <div class="auth-section">
                    <h3>API ì„¤ì •</h3>
                    <label>Base URL</label>
                    <input type="text" id="baseUrl" value="" placeholder="http://localhost:8080">
                </div>

                <div class="auth-section">
                    <h3>í˜„ì¬ ì‚¬ì—…ì¥ ID</h3>
                    <input type="text" id="globalSiteId" placeholder="ì‚¬ì—…ì¥ ìƒì„± í›„ ìë™ ì…ë ¥" readonly style="background: #f0f0f0;">
                    <button onclick="fillAllSiteIds()" class="button-secondary" style="font-size: 12px; padding: 8px;">ëª¨ë“  í¼ì— ì ìš©</button>
                </div>
            </div>

            <!-- ë©”ì¸ ì½˜í…ì¸  -->
            <div class="main">
                <div class="tab-buttons">
                    <button class="tab-button active" onclick="switchTab('auth')">ì¸ì¦</button>
                    <button class="tab-button" onclick="switchTab('sites')">ì‚¬ì—…ì¥</button>
                    <button class="tab-button" onclick="switchTab('analysis')">ë¶„ì„</button>
                    <button class="tab-button" onclick="switchTab('dashboard')">ëŒ€ì‹œë³´ë“œ</button>
                    <button class="tab-button" onclick="switchTab('simulation')">ì‹œë®¬ë ˆì´ì…˜</button>
                    <button class="tab-button" onclick="switchTab('report')">ë¦¬í¬íŠ¸</button>
                    <button class="tab-button" onclick="switchTab('past')">ê³¼ê±°ì¬í•´</button>
                </div>

                <!-- ì¸ì¦ API íƒ­ -->
                <div id="authTab" class="tab-content active">
                    <div class="api-section">
                        <h3>íšŒì›ê°€ì…</h3>
                        <div class="api-endpoint">
                            <h4><span class="method post">POST</span>/api/auth/register</h4>

                            <label>ì´ë¦„</label>
                            <input type="text" id="regName" placeholder="í™ê¸¸ë™">

                            <label>ì´ë©”ì¼</label>
                            <input type="email" id="regEmail" placeholder="user@example.com">

                            <label>ë¹„ë°€ë²ˆí˜¸</label>
                            <input type="password" id="regPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ (8ì ì´ìƒ)">

                            <button onclick="register()">íšŒì›ê°€ì…</button>
                            <div id="registerResponse" class="response"><pre></pre></div>
                        </div>
                    </div>
                </div>

                <!-- ì‚¬ì—…ì¥ API íƒ­ -->
                <div id="sitesTab" class="tab-content">
                    <div class="api-section">
                        <h3>ì‚¬ì—…ì¥ ê´€ë¦¬</h3>

                        <div class="api-endpoint">
                            <h4><span class="method get">GET</span>/api/sites</h4>
                            <button onclick="getSites()">ì‚¬ì—…ì¥ ëª©ë¡ ì¡°íšŒ</button>
                            <div id="getSitesResponse" class="response"><pre></pre></div>
                        </div>

                        <div class="api-endpoint">
                            <h4><span class="method post">POST</span>/api/sites</h4>

                            <label>ì‚¬ì—…ì¥ ì´ë¦„</label>
                            <input type="text" id="siteName" placeholder="ì„œìš¸ ë³¸ì‚¬">

                            <label>ë„ë¡œëª… ì£¼ì†Œ</label>
                            <input type="text" id="siteRoadAddr" placeholder="ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123">

                            <label>ì§€ë²ˆ ì£¼ì†Œ</label>
                            <input type="text" id="siteJibunAddr" placeholder="ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™ 123-45">

                            <div class="grid-2">
                                <div>
                                    <label>ìœ„ë„</label>
                                    <input type="text" id="siteLatitude" value="37.5665" placeholder="37.5665">
                                </div>
                                <div>
                                    <label>ê²½ë„</label>
                                    <input type="text" id="siteLongitude" value="126.9780" placeholder="126.9780">
                                </div>
                            </div>

                            <label>ì‚°ì—… ìœ í˜•</label>
                            <select id="siteType">
                                <option value="data_center">ë°ì´í„°ì„¼í„°</option>
                                <option value="manufacturing">ì œì¡°ì—…</option>
                                <option value="logistics">ë¬¼ë¥˜</option>
                                <option value="retail">ìœ í†µ</option>
                                <option value="technology">ê¸°ìˆ </option>
                                <option value="finance">ê¸ˆìœµ</option>
                            </select>

                            <button onclick="createSite()">ì‚¬ì—…ì¥ ìƒì„±</button>
                            <div id="createSiteResponse" class="response"><pre></pre></div>
                        </div>
                    </div>
                </div>

                <!-- ë¶„ì„ API íƒ­ -->
                <div id="analysisTab" class="tab-content">
                    <div class="api-section">
                        <h3>ë¦¬ìŠ¤í¬ ë¶„ì„</h3>

                        <div class="api-endpoint">
                            <h4><span class="method post">POST</span>/api/analysis/start</h4>

                            <label>ì‚¬ì—…ì¥ ID (UUID)</label>
                            <input type="text" class="site-id-field" id="analysisSiteId" placeholder="ì‚¬ì—…ì¥ ID">

                            <button onclick="startAnalysis()">ë¶„ì„ ì‹œì‘</button>
                            <div id="startAnalysisResponse" class="response"><pre></pre></div>
                        </div>

                        <div class="api-endpoint">
                            <h4><span class="method get">GET</span>/api/analysis/status?jobid={jobid}</h4>

                            <label>ì‘ì—… ID (jobid)</label>
                            <input type="text" id="statusJobId" placeholder="ì‘ì—… ID">

                            <button onclick="getAnalysisStatus()">ë¶„ì„ ìƒíƒœ ì¡°íšŒ</button>
                            <div id="analysisStatusResponse" class="response"><pre></pre></div>
                        </div>

                        <div class="api-endpoint">
                            <h4><span class="method get">GET</span>/api/analysis/summary?siteId={siteId}</h4>

                            <label>ì‚¬ì—…ì¥ ID</label>
                            <input type="text" class="site-id-field" id="summarySiteId" placeholder="UUID">

                            <button onclick="getAnalysisSummary()">ë¶„ì„ ê°œìš” ì¡°íšŒ</button>
                            <div id="summaryResponse" class="response"><pre></pre></div>
                        </div>

                        <div class="api-endpoint">
                            <h4><span class="method get">GET</span>/api/analysis/physical-risk</h4>

                            <label>ì‚¬ì—…ì¥ ID</label>
                            <input type="text" class="site-id-field" id="physicalRiskSiteId" placeholder="UUID">

                            <label>ê¸°ê°„ (term)</label>
                            <select id="physicalRiskTerm">
                                <option value="long">ì¥ê¸° (long)</option>
                                <option value="mid">ì¤‘ê¸° (mid)</option>
                                <option value="short">ë‹¨ê¸° (short)</option>
                            </select>

                            <label>ì¬í•´ ìœ í˜• (hazardType)</label>
                            <select id="physicalRiskHazardType">
                                <option value="ê·¹ì‹¬í•œ ê³ ì˜¨">ê·¹ì‹¬í•œ ê³ ì˜¨</option>
                                <option value="ê·¹ì‹¬í•œ í•œíŒŒ">ê·¹ì‹¬í•œ í•œíŒŒ</option>
                                <option value="í•˜ì²œ í™ìˆ˜">í•˜ì²œ í™ìˆ˜</option>
                                <option value="ë„ì‹œ í™ìˆ˜">ë„ì‹œ í™ìˆ˜</option>
                                <option value="ê°€ë­„">ê°€ë­„</option>
                                <option value="ë¬¼ ë¶€ì¡±">ë¬¼ ë¶€ì¡±</option>
                                <option value="í•´ìˆ˜ë©´ ìƒìŠ¹">í•´ìˆ˜ë©´ ìƒìŠ¹</option>
                                <option value="íƒœí’">íƒœí’</option>
                                <option value="ì‚°ë¶ˆ">ì‚°ë¶ˆ</option>
                            </select>

                            <button onclick="getPhysicalRisk()">ë¬¼ë¦¬ì  ë¦¬ìŠ¤í¬ ì¡°íšŒ</button>
                            <div id="physicalRiskResponse" class="response"><pre></pre></div>
                        </div>

                        <div class="api-endpoint">
                            <h4><span class="method get">GET</span>/api/analysis/aal</h4>

                            <label>ì‚¬ì—…ì¥ ID</label>
                            <input type="text" class="site-id-field" id="aalSiteId" placeholder="UUID">

                            <label>ê¸°ê°„ (term)</label>
                            <select id="aalTerm">
                                <option value="long">ì¥ê¸° (long)</option>
                                <option value="mid">ì¤‘ê¸° (mid)</option>
                                <option value="short">ë‹¨ê¸° (short)</option>
                            </select>

                            <label>ì¬í•´ ìœ í˜• (hazardType)</label>
                            <select id="aalHazardType">
                                <option value="ê·¹ì‹¬í•œ ê³ ì˜¨">ê·¹ì‹¬í•œ ê³ ì˜¨</option>
                                <option value="ê·¹ì‹¬í•œ í•œíŒŒ">ê·¹ì‹¬í•œ í•œíŒŒ</option>
                                <option value="í•˜ì²œ í™ìˆ˜">í•˜ì²œ í™ìˆ˜</option>
                                <option value="ë„ì‹œ í™ìˆ˜">ë„ì‹œ í™ìˆ˜</option>
                                <option value="ê°€ë­„">ê°€ë­„</option>
                                <option value="ë¬¼ ë¶€ì¡±">ë¬¼ ë¶€ì¡±</option>
                                <option value="í•´ìˆ˜ë©´ ìƒìŠ¹">í•´ìˆ˜ë©´ ìƒìŠ¹</option>
                                <option value="íƒœí’">íƒœí’</option>
                                <option value="ì‚°ë¶ˆ">ì‚°ë¶ˆ</option>
                            </select>

                            <button onclick="getAal()">ì¬ë¬´ ì˜í–¥ ì¡°íšŒ</button>
                            <div id="aalResponse" class="response"><pre></pre></div>
                        </div>

                        <div class="api-endpoint">
                            <h4><span class="method get">GET</span>/api/analysis/vulnerability?siteId={siteId}</h4>

                            <label>ì‚¬ì—…ì¥ ID</label>
                            <input type="text" class="site-id-field" id="vulnerabilitySiteId" placeholder="UUID">

                            <button onclick="getVulnerability()">ì·¨ì•½ì„± ë¶„ì„ ì¡°íšŒ</button>
                            <div id="vulnerabilityResponse" class="response"><pre></pre></div>
                        </div>
                    </div>
                </div>

                <!-- ëŒ€ì‹œë³´ë“œ API íƒ­ -->
                <div id="dashboardTab" class="tab-content">
                    <div class="api-section">
                        <h3>ëŒ€ì‹œë³´ë“œ</h3>

                        <div class="api-endpoint">
                            <h4><span class="method get">GET</span>/api/dashboard</h4>
                            <button onclick="getDashboard()">ëŒ€ì‹œë³´ë“œ ì¡°íšŒ</button>
                            <div id="dashboardResponse" class="response"><pre></pre></div>
                        </div>
                    </div>
                </div>

                <!-- ì‹œë®¬ë ˆì´ì…˜ API íƒ­ -->
                <div id="simulationTab" class="tab-content">
                    <div class="api-section">
                        <h3>ì‹œë®¬ë ˆì´ì…˜</h3>

                        <div class="api-endpoint">
                            <h4><span class="method get">GET</span>/api/simulation/location/recommendation</h4>

                            <label>ì‚¬ì—…ì¥ ID</label>
                            <input type="text" class="site-id-field" id="recSiteId" placeholder="UUID">

                            <button onclick="getLocationRecommendation()">ìœ„ì¹˜ ì¶”ì²œ ì¡°íšŒ</button>
                            <div id="recommendationResponse" class="response"><pre></pre></div>
                        </div>

                        <div class="api-endpoint">
                            <h4><span class="method post">POST</span>/api/simulation/location/compare</h4>

                            <label>í˜„ì¬ ì‚¬ì—…ì¥ ID</label>
                            <input type="text" class="site-id-field" id="compareCurrentSiteId" placeholder="UUID">

                            <div class="grid-2">
                                <div>
                                    <label>í›„ë³´ì§€ ìœ„ë„</label>
                                    <input type="text" id="compareLatitude" value="36.5040736" placeholder="36.5040736">
                                </div>
                                <div>
                                    <label>í›„ë³´ì§€ ê²½ë„</label>
                                    <input type="text" id="compareLongitude" value="127.2494855" placeholder="127.2494855">
                                </div>
                            </div>

                            <label>í›„ë³´ì§€ ë„ë¡œëª… ì£¼ì†Œ (ì„ íƒ)</label>
                            <input type="text" id="compareRoadAddr" value="ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ í•œëˆ„ë¦¬ëŒ€ë¡œ 2130" placeholder="ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ í•œëˆ„ë¦¬ëŒ€ë¡œ 2130">

                            <label>í›„ë³´ì§€ ì§€ë²ˆ ì£¼ì†Œ (ì„ íƒ)</label>
                            <input type="text" id="compareJibunAddr" value="ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ ë³´ëŒë™ 660" placeholder="ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ ë³´ëŒë™ 660">

                            <button onclick="compareLocation()">ìœ„ì¹˜ ë¹„êµ</button>
                            <div id="compareResponse" class="response"><pre></pre></div>
                        </div>

                        <div class="api-endpoint">
                            <h4><span class="method post">POST</span>/api/simulation/climate</h4>

                            <label>ì‹œë‚˜ë¦¬ì˜¤</label>
                            <select id="climateScenario">
                                <option value="SSP2-4.5">SSP2-4.5</option>
                                <option value="SSP5-8.5">SSP5-8.5</option>
                                <option value="SSP1-2.6">SSP1-2.6</option>
                            </select>

                            <label>ì¬í•´ ìœ í˜•</label>
                            <select id="climateHazardType">
                                <option value="ê·¹ì‹¬í•œ ê³ ì˜¨">ê·¹ì‹¬í•œ ê³ ì˜¨</option>
                                <option value="ê·¹ì‹¬í•œ í•œíŒŒ">ê·¹ì‹¬í•œ í•œíŒŒ</option>
                                <option value="í•˜ì²œ í™ìˆ˜">í•˜ì²œ í™ìˆ˜</option>
                                <option value="ë„ì‹œ í™ìˆ˜">ë„ì‹œ í™ìˆ˜</option>
                                <option value="ê°€ë­„">ê°€ë­„</option>
                                <option value="ë¬¼ ë¶€ì¡±">ë¬¼ ë¶€ì¡±</option>
                                <option value="í•´ìˆ˜ë©´ ìƒìŠ¹">í•´ìˆ˜ë©´ ìƒìŠ¹</option>
                                <option value="íƒœí’">íƒœí’</option>
                                <option value="ì‚°ë¶ˆ">ì‚°ë¶ˆ</option>
                            </select>

                            <button onclick="runClimateSimulation()">ê¸°í›„ ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰</button>
                            <div id="climateResponse" class="response"><pre></pre></div>
                        </div>
                    </div>
                </div>

                <!-- ë¦¬í¬íŠ¸ API íƒ­ -->
                <div id="reportTab" class="tab-content">
                    <div class="api-section">
                        <h3>ë¦¬í¬íŠ¸</h3>

                        <div class="api-endpoint">
                            <h4><span class="method get">GET</span>/api/report</h4>
                            <button onclick="getReport()">í†µí•© ë¦¬í¬íŠ¸ ì¡°íšŒ</button>
                            <div id="reportResponse" class="response"><pre></pre></div>
                        </div>

                        <div class="api-endpoint">
                            <h4><span class="method post">POST</span>/api/report/data</h4>

                            <label>ì‚¬ì—…ì¥ ID</label>
                            <input type="text" class="site-id-field" id="reportDataSiteId" placeholder="UUID">

                            <label>ë°ì´í„° (JSON)</label>
                            <textarea id="reportDataContent" placeholder='{"key": "value", "example": "data"}'></textarea>

                            <button onclick="registerReportData()">ë¦¬í¬íŠ¸ ë°ì´í„° ë“±ë¡</button>
                            <div id="reportDataResponse" class="response"><pre></pre></div>
                        </div>
                    </div>
                </div>

                <!-- ê³¼ê±°ì¬í•´ API íƒ­ -->
                <div id="pastTab" class="tab-content">
                    <div class="api-section">
                        <h3>ê³¼ê±° ì¬í•´ ì´ë ¥</h3>

                        <div class="api-endpoint">
                            <h4><span class="method get">GET</span>/api/past</h4>

                            <label>ì—°ë„ (year)</label>
                            <input type="number" id="pastYear" value="2023" placeholder="2023">

                            <label>ì¬í•´ ìœ í˜• (disaster_type)</label>
                            <select id="pastDisasterType">
                                <option value="í˜¸ìš°">í˜¸ìš°</option>
                                <option value="íƒœí’">íƒœí’</option>
                                <option value="ëŒ€ì„¤">ëŒ€ì„¤</option>
                                <option value="í­ì—¼">í­ì—¼</option>
                                <option value="í•œíŒŒ">í•œíŒŒ</option>
                                <option value="ì§€ì§„">ì§€ì§„</option>
                                <option value="ì‚°ë¶ˆ">ì‚°ë¶ˆ</option>
                            </select>

                            <label>ì‹¬ê°ë„ (severity)</label>
                            <select id="pastSeverity">
                                <option value="ê²½ë³´">ê²½ë³´</option>
                                <option value="ì£¼ì˜ë³´">ì£¼ì˜ë³´</option>
                                <option value="íŠ¹ë³´">íŠ¹ë³´</option>
                            </select>

                            <button onclick="getPastDisasters()">ê³¼ê±° ì¬í•´ ì¡°íšŒ</button>
                            <div id="pastResponse" class="response"><pre></pre></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let accessToken = null;
        let refreshToken = null;
        let currentUser = null;
        let currentSiteId = null;

        function getBaseUrl() {
            return document.getElementById('baseUrl').value;
        }

        function showResponse(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.querySelector('pre').textContent = JSON.stringify(data, null, 2);
            element.style.background = isError ? '#2d1e1e' : '#1e1e1e';
        }

        function showError(elementId, message) {
            showResponse(elementId, { error: message }, true);
        }

        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch(`${getBaseUrl()}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (response.ok) {
                    accessToken = data.accessToken;
                    refreshToken = data.refreshToken;
                    currentUser = { email };

                    updateAuthUI();
                    alert('ë¡œê·¸ì¸ ì„±ê³µ!');
                } else {
                    alert('ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                alert('ë¡œê·¸ì¸ ì˜¤ë¥˜: ' + error.message);
            }
        }

        async function register() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;

            if (!name || !email || !password) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                const response = await fetch(`${getBaseUrl()}/api/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password })
                });

                const data = await response.json();
                showResponse('registerResponse', data, !response.ok);

                if (response.ok) {
                    alert('íšŒì›ê°€ì… ì„±ê³µ! ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                    document.getElementById('loginEmail').value = email;
                    document.getElementById('loginPassword').value = password;
                    switchTab('auth');
                }
            } catch (error) {
                showError('registerResponse', error.message);
            }
        }

        function logout() {
            accessToken = null;
            refreshToken = null;
            currentUser = null;
            currentSiteId = null;
            updateAuthUI();
        }

        function updateAuthUI() {
            const authStatus = document.getElementById('authStatus');
            const loginForm = document.getElementById('loginForm');
            const loggedInInfo = document.getElementById('loggedInInfo');
            const userInfo = document.getElementById('userInfo');
            const tokenDisplay = document.getElementById('tokenDisplay');

            if (accessToken) {
                authStatus.textContent = 'ë¡œê·¸ì¸ë¨';
                authStatus.className = 'status-badge logged-in';
                loginForm.style.display = 'none';
                loggedInInfo.style.display = 'block';
                userInfo.textContent = `ë¡œê·¸ì¸: ${currentUser.email}`;
                tokenDisplay.textContent = `Token: ${accessToken.substring(0, 50)}...`;
            } else {
                authStatus.textContent = 'ë¡œê·¸ì•„ì›ƒ';
                authStatus.className = 'status-badge logged-out';
                loginForm.style.display = 'block';
                loggedInInfo.style.display = 'none';
            }
        }

        function getAuthHeaders() {
            if (!accessToken) {
                throw new Error('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            }
            return {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${accessToken}`
            };
        }

        function updateGlobalSiteId(siteId) {
            currentSiteId = siteId;
            document.getElementById('globalSiteId').value = siteId;
        }

        function fillAllSiteIds() {
            if (!currentSiteId) {
                alert('ì‚¬ì—…ì¥ IDê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì‚¬ì—…ì¥ì„ ìƒì„±í•˜ê±°ë‚˜ ì¡°íšŒí•˜ì„¸ìš”.');
                return;
            }
            document.querySelectorAll('.site-id-field').forEach(input => {
                input.value = currentSiteId;
            });
            alert('ëª¨ë“  ì‚¬ì—…ì¥ ID í•„ë“œì— ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        async function getSites() {
            try {
                const response = await fetch(`${getBaseUrl()}/api/sites`, {
                    headers: getAuthHeaders()
                });

                const data = await response.json();
                showResponse('getSitesResponse', data, !response.ok);

                // ì²« ë²ˆì§¸ ì‚¬ì—…ì¥ ID ìë™ ì…ë ¥
                if (response.ok && data.sites && data.sites.length > 0) {
                    updateGlobalSiteId(data.sites[0].id);
                    fillAllSiteIds();
                }
            } catch (error) {
                showError('getSitesResponse', error.message);
            }
        }

        async function createSite() {
            try {
                const requestBody = {
                    name: document.getElementById('siteName').value,
                    roadAddress: document.getElementById('siteRoadAddr').value,
                    jibunAddress: document.getElementById('siteJibunAddr').value,
                    latitude: document.getElementById('siteLatitude').value,
                    longitude: document.getElementById('siteLongitude').value,
                    type: document.getElementById('siteType').value
                };

                const response = await fetch(`${getBaseUrl()}/api/sites`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();
                showResponse('createSiteResponse', data, !response.ok);

                if (response.ok && data.id) {
                    alert('ì‚¬ì—…ì¥ ìƒì„± ì„±ê³µ!');
                    updateGlobalSiteId(data.id);
                    fillAllSiteIds();
                }
            } catch (error) {
                showError('createSiteResponse', error.message);
            }
        }

        async function startAnalysis() {
            try {
                const siteId = document.getElementById('analysisSiteId').value;
                if (!siteId) {
                    alert('ì‚¬ì—…ì¥ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }

                const requestBody = {
                    sites: [{ siteId: siteId }]
                };

                const response = await fetch(`${getBaseUrl()}/api/analysis/start`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();
                showResponse('startAnalysisResponse', data, !response.ok);

                if (response.ok && data.jobId) {
                    document.getElementById('statusJobId').value = data.jobId;
                    alert('ë¶„ì„ ì‹œì‘! Job ID: ' + data.jobId);
                }
            } catch (error) {
                showError('startAnalysisResponse', error.message);
            }
        }

        async function getAnalysisStatus() {
            try {
                const jobid = document.getElementById('statusJobId').value;
                const url = jobid
                    ? `${getBaseUrl()}/api/analysis/status?jobid=${jobid}`
                    : `${getBaseUrl()}/api/analysis/status`;

                const response = await fetch(url, {
                    headers: getAuthHeaders()
                });

                const data = await response.json();
                showResponse('analysisStatusResponse', data, !response.ok);
            } catch (error) {
                showError('analysisStatusResponse', error.message);
            }
        }

        async function getAnalysisSummary() {
            try {
                const siteId = document.getElementById('summarySiteId').value;
                if (!siteId) {
                    alert('ì‚¬ì—…ì¥ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }

                const response = await fetch(`${getBaseUrl()}/api/analysis/summary?siteId=${siteId}`, {
                    headers: getAuthHeaders()
                });

                const data = await response.json();
                showResponse('summaryResponse', data, !response.ok);
            } catch (error) {
                showError('summaryResponse', error.message);
            }
        }

        async function getPhysicalRisk() {
            try {
                const siteId = document.getElementById('physicalRiskSiteId').value;
                const term = document.getElementById('physicalRiskTerm').value;
                const hazardType = document.getElementById('physicalRiskHazardType').value;

                if (!siteId) {
                    alert('ì‚¬ì—…ì¥ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }

                const url = `${getBaseUrl()}/api/analysis/physical-risk?siteId=${siteId}&term=${term}&hazardType=${encodeURIComponent(hazardType)}`;
                const response = await fetch(url, {
                    headers: getAuthHeaders()
                });

                const data = await response.json();
                showResponse('physicalRiskResponse', data, !response.ok);
            } catch (error) {
                showError('physicalRiskResponse', error.message);
            }
        }

        async function getAal() {
            try {
                const siteId = document.getElementById('aalSiteId').value;
                const term = document.getElementById('aalTerm').value;
                const hazardType = document.getElementById('aalHazardType').value;

                if (!siteId) {
                    alert('ì‚¬ì—…ì¥ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }

                const url = `${getBaseUrl()}/api/analysis/aal?siteId=${siteId}&term=${term}&hazardType=${encodeURIComponent(hazardType)}`;
                const response = await fetch(url, {
                    headers: getAuthHeaders()
                });

                const data = await response.json();
                showResponse('aalResponse', data, !response.ok);
            } catch (error) {
                showError('aalResponse', error.message);
            }
        }

        async function getVulnerability() {
            try {
                const siteId = document.getElementById('vulnerabilitySiteId').value;
                if (!siteId) {
                    alert('ì‚¬ì—…ì¥ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }

                const response = await fetch(`${getBaseUrl()}/api/analysis/vulnerability?siteId=${siteId}`, {
                    headers: getAuthHeaders()
                });

                const data = await response.json();
                showResponse('vulnerabilityResponse', data, !response.ok);
            } catch (error) {
                showError('vulnerabilityResponse', error.message);
            }
        }

        async function getDashboard() {
            try {
                const response = await fetch(`${getBaseUrl()}/api/dashboard`, {
                    headers: getAuthHeaders()
                });

                const data = await response.json();
                showResponse('dashboardResponse', data, !response.ok);
            } catch (error) {
                showError('dashboardResponse', error.message);
            }
        }

        async function getLocationRecommendation() {
            try {
                const siteId = document.getElementById('recSiteId').value;
                if (!siteId) {
                    alert('ì‚¬ì—…ì¥ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }

                const response = await fetch(`${getBaseUrl()}/api/simulation/location/recommendation?siteId=${siteId}`, {
                    headers: getAuthHeaders()
                });

                const data = await response.json();
                showResponse('recommendationResponse', data, !response.ok);
            } catch (error) {
                showError('recommendationResponse', error.message);
            }
        }

        async function compareLocation() {
            try {
                const requestBody = {
                    currentSiteId: document.getElementById('compareCurrentSiteId').value,
                    latitude: document.getElementById('compareLatitude').value,
                    longitude: document.getElementById('compareLongitude').value,
                    roadAddress: document.getElementById('compareRoadAddr').value,
                    jibunAddress: document.getElementById('compareJibunAddr').value
                };

                if (!requestBody.currentSiteId || !requestBody.latitude || !requestBody.longitude) {
                    alert('í•„ìˆ˜ í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }

                const response = await fetch(`${getBaseUrl()}/api/simulation/location/compare`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();
                showResponse('compareResponse', data, !response.ok);
            } catch (error) {
                showError('compareResponse', error.message);
            }
        }

        async function runClimateSimulation() {
            try {
                const requestBody = {
                    scenario: document.getElementById('climateScenario').value,
                    hazardType: document.getElementById('climateHazardType').value
                };

                const response = await fetch(`${getBaseUrl()}/api/simulation/climate`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();
                showResponse('climateResponse', data, !response.ok);
            } catch (error) {
                showError('climateResponse', error.message);
            }
        }

        async function getReport() {
            try {
                const response = await fetch(`${getBaseUrl()}/api/report`, {
                    headers: getAuthHeaders()
                });

                const data = await response.json();
                showResponse('reportResponse', data, !response.ok);
            } catch (error) {
                showError('reportResponse', error.message);
            }
        }

        async function registerReportData() {
            try {
                const siteId = document.getElementById('reportDataSiteId').value;
                const dataContent = document.getElementById('reportDataContent').value;

                if (!siteId) {
                    alert('ì‚¬ì—…ì¥ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }

                let parsedData;
                try {
                    parsedData = dataContent ? JSON.parse(dataContent) : {};
                } catch (e) {
                    alert('ì˜ëª»ëœ JSON í˜•ì‹ì…ë‹ˆë‹¤.');
                    return;
                }

                const requestBody = {
                    siteId: siteId,
                    ...parsedData
                };

                const response = await fetch(`${getBaseUrl()}/api/report/data`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();
                showResponse('reportDataResponse', data, !response.ok);

                if (response.ok) {
                    alert('ë¦¬í¬íŠ¸ ë°ì´í„° ë“±ë¡ ì„±ê³µ!');
                }
            } catch (error) {
                showError('reportDataResponse', error.message);
            }
        }

        async function getPastDisasters() {
            try {
                const year = document.getElementById('pastYear').value;
                const disasterType = document.getElementById('pastDisasterType').value;
                const severity = document.getElementById('pastSeverity').value;

                const url = `${getBaseUrl()}/api/past?year=${year}&disaster_type=${encodeURIComponent(disasterType)}&severity=${encodeURIComponent(severity)}`;
                const response = await fetch(url, {
                    headers: getAuthHeaders()
                });

                const data = await response.json();
                showResponse('pastResponse', data, !response.ok);
            } catch (error) {
                showError('pastResponse', error.message);
            }
        }

        function switchTab(tabName) {
            // ëª¨ë“  íƒ­ ë²„íŠ¼ê³¼ ì½˜í…ì¸  ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // ì„ íƒëœ íƒ­ í™œì„±í™”
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        function showRegisterForm() {
            switchTab('auth');
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // í˜„ì¬ í˜ì´ì§€ì˜ originì„ baseUrlë¡œ ì„¤ì •
            const currentOrigin = window.location.origin;
            document.getElementById('baseUrl').value = currentOrigin;
            updateAuthUI();
        });
    </script>
</body>
</html>
