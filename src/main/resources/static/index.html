<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKAX Physical Risk Management API - í…ŒìŠ¤íŠ¸ í˜ì´ì§€</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 0;
        }

        .sidebar {
            background: #f8f9fa;
            padding: 30px;
            border-right: 1px solid #e0e0e0;
        }

        .main {
            padding: 30px;
        }

        .auth-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .auth-section h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-badge.logged-out {
            background: #fee;
            color: #c00;
        }

        .status-badge.logged-in {
            background: #efe;
            color: #0a0;
        }

        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-bottom: 12px;
            font-size: 14px;
            font-family: inherit;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
            font-family: 'Courier New', monospace;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-size: 13px;
            font-weight: 500;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            width: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .button-secondary {
            background: #6c757d;
        }

        .button-danger {
            background: #dc3545;
        }

        .api-section {
            margin-bottom: 30px;
        }

        .api-section h3 {
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            font-size: 18px;
        }

        .api-endpoint {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
        }

        .api-endpoint h4 {
            color: #555;
            margin-bottom: 12px;
            font-size: 15px;
        }

        .method {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 700;
            margin-right: 8px;
        }

        .method.get { background: #61affe; color: white; }
        .method.post { background: #49cc90; color: white; }
        .method.put { background: #fca130; color: white; }
        .method.delete { background: #f93e3e; color: white; }

        .response {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
        }

        .response pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .token-display {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            word-break: break-all;
        }

        .user-info {
            background: #d1ecf1;
            border: 1px solid #0c5460;
            color: #0c5460;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 13px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .api-list {
            list-style: none;
        }

        .api-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .api-list li:last-child {
            border-bottom: none;
        }

        .loading {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.6s linear infinite;
            margin-left: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
            border: 1px solid #f5c6cb;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
            border: 1px solid #c3e6cb;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab-button {
            background: none;
            color: #666;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            width: auto;
        }

        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ SKAX Physical Risk Management API</h1>
            <p>ê¸°í›„ ë¬¼ë¦¬ì  ë¦¬ìŠ¤í¬ ê´€ë¦¬ ì‹œìŠ¤í…œ API í…ŒìŠ¤íŠ¸ ë„êµ¬</p>
        </div>

        <div class="content">
            <!-- ì‚¬ì´ë“œë°” -->
            <div class="sidebar">
                <div class="auth-section">
                    <h3>
                        ì¸ì¦ ìƒíƒœ
                        <span id="authStatus" class="status-badge logged-out">ë¡œê·¸ì•„ì›ƒ</span>
                    </h3>

                    <div id="loginForm">
                        <label>ì´ë©”ì¼</label>
                        <input type="email" id="loginEmail" value="test@example.com" placeholder="ì´ë©”ì¼ ì…ë ¥">

                        <label>ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="loginPassword" value="password123" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">

                        <button onclick="login()">ë¡œê·¸ì¸</button>

                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
                            <button onclick="showRegisterForm()" class="button-secondary">íšŒì›ê°€ì…</button>
                        </div>
                    </div>

                    <div id="loggedInInfo" style="display: none;">
                        <div class="user-info" id="userInfo"></div>
                        <div class="token-display" id="tokenDisplay"></div>
                        <button onclick="logout()" class="button-danger" style="margin-top: 15px;">ë¡œê·¸ì•„ì›ƒ</button>
                    </div>
                </div>

                <div class="auth-section">
                    <h3>API ì„¤ì •</h3>
                    <label>Base URL</label>
                    <input type="text" id="baseUrl" value="" placeholder="http://localhost:8080">
                </div>
            </div>

            <!-- ë©”ì¸ ì½˜í…ì¸  -->
            <div class="main">
                <div class="tab-buttons">
                    <button class="tab-button active" onclick="switchTab('auth')">ì¸ì¦ API</button>
                    <button class="tab-button" onclick="switchTab('sites')">ì‚¬ì—…ì¥ API</button>
                    <button class="tab-button" onclick="switchTab('analysis')">ë¶„ì„ API</button>
                </div>

                <!-- ì¸ì¦ API íƒ­ -->
                <div id="authTab" class="tab-content active">
                    <div class="api-section">
                        <h3>íšŒì›ê°€ì…</h3>
                        <div class="api-endpoint">
                            <h4><span class="method post">POST</span>/api/auth/register</h4>

                            <label>ì´ë¦„</label>
                            <input type="text" id="regName" placeholder="í™ê¸¸ë™">

                            <label>ì´ë©”ì¼</label>
                            <input type="email" id="regEmail" placeholder="user@example.com">

                            <label>ë¹„ë°€ë²ˆí˜¸</label>
                            <input type="password" id="regPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ (8ì ì´ìƒ)">

                            <button onclick="register()">íšŒì›ê°€ì…</button>
                            <div id="registerResponse" class="response" style="display: none;"><pre></pre></div>
                        </div>
                    </div>
                </div>

                <!-- ì‚¬ì—…ì¥ API íƒ­ -->
                <div id="sitesTab" class="tab-content">
                    <div class="api-section">
                        <h3>ì‚¬ì—…ì¥ ê´€ë¦¬</h3>

                        <div class="api-endpoint">
                            <h4><span class="method get">GET</span>/api/sites</h4>
                            <button onclick="getSites()">ì‚¬ì—…ì¥ ëª©ë¡ ì¡°íšŒ</button>
                            <div id="getSitesResponse" class="response" style="display: none;"><pre></pre></div>
                        </div>

                        <div class="api-endpoint">
                            <h4><span class="method post">POST</span>/api/sites</h4>

                            <label>ì‚¬ì—…ì¥ ì´ë¦„</label>
                            <input type="text" id="siteName" placeholder="ì„œìš¸ ë³¸ì‚¬">

                            <label>ë„ë¡œëª… ì£¼ì†Œ</label>
                            <input type="text" id="siteRoadAddr" placeholder="ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123">

                            <label>ì§€ë²ˆ ì£¼ì†Œ</label>
                            <input type="text" id="siteJibunAddr" placeholder="ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™ 123-45">

                            <div class="grid-2">
                                <div>
                                    <label>ìœ„ë„</label>
                                    <input type="text" id="siteLatitude" placeholder="37.5665">
                                </div>
                                <div>
                                    <label>ê²½ë„</label>
                                    <input type="text" id="siteLongitude" placeholder="126.9780">
                                </div>
                            </div>

                            <label>ì‚°ì—… ìœ í˜•</label>
                            <select id="siteType">
                                <option value="manufacturing">ì œì¡°ì—…</option>
                                <option value="logistics">ë¬¼ë¥˜</option>
                                <option value="retail">ìœ í†µ</option>
                                <option value="technology">ê¸°ìˆ </option>
                                <option value="finance">ê¸ˆìœµ</option>
                            </select>

                            <button onclick="createSite()">ì‚¬ì—…ì¥ ìƒì„±</button>
                            <div id="createSiteResponse" class="response" style="display: none;"><pre></pre></div>
                        </div>
                    </div>
                </div>

                <!-- ë¶„ì„ API íƒ­ -->
                <div id="analysisTab" class="tab-content">
                    <div class="api-section">
                        <h3>ë¦¬ìŠ¤í¬ ë¶„ì„</h3>

                        <div class="api-endpoint">
                            <h4><span class="method post">POST</span>/api/analysis/start</h4>

                            <label>ì‚¬ì—…ì¥ ID (UUID)</label>
                            <input type="text" id="analysisSiteId" placeholder="ì‚¬ì—…ì¥ ID ì…ë ¥ ë˜ëŠ” ìœ„ì—ì„œ ìƒì„±">

                            <div class="grid-2">
                                <div>
                                    <label>ìœ„ë„</label>
                                    <input type="text" id="analysisLatitude" placeholder="37.5665">
                                </div>
                                <div>
                                    <label>ê²½ë„</label>
                                    <input type="text" id="analysisLongitude" placeholder="126.9780">
                                </div>
                            </div>

                            <label>ì‚°ì—… ìœ í˜•</label>
                            <select id="analysisIndustryType">
                                <option value="manufacturing">ì œì¡°ì—…</option>
                                <option value="logistics">ë¬¼ë¥˜</option>
                                <option value="retail">ìœ í†µ</option>
                                <option value="technology">ê¸°ìˆ </option>
                                <option value="finance">ê¸ˆìœµ</option>
                            </select>

                            <button onclick="startAnalysis()">ë¶„ì„ ì‹œì‘</button>
                            <div id="startAnalysisResponse" class="response" style="display: none;"><pre></pre></div>
                        </div>

                        <div class="api-endpoint">
                            <h4><span class="method get">GET</span>/api/analysis/status?siteId={siteId}&jobId={jobId}</h4>

                            <label>ì‚¬ì—…ì¥ ID</label>
                            <input type="text" id="statusSiteId" placeholder="ì‚¬ì—…ì¥ ID">

                            <label>ì‘ì—… ID</label>
                            <input type="text" id="statusJobId" placeholder="ì‘ì—… ID">

                            <button onclick="getAnalysisStatus()">ë¶„ì„ ìƒíƒœ ì¡°íšŒ</button>
                            <div id="analysisStatusResponse" class="response" style="display: none;"><pre></pre></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let accessToken = null;
        let refreshToken = null;
        let currentUser = null;

        function getBaseUrl() {
            return document.getElementById('baseUrl').value;
        }

        function showResponse(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.querySelector('pre').textContent = JSON.stringify(data, null, 2);
            element.style.background = isError ? '#2d1e1e' : '#1e1e1e';
        }

        function showError(elementId, message) {
            showResponse(elementId, { error: message }, true);
        }

        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch(`${getBaseUrl()}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (response.ok) {
                    accessToken = data.accessToken;
                    refreshToken = data.refreshToken;
                    currentUser = { email };

                    updateAuthUI();
                    alert('ë¡œê·¸ì¸ ì„±ê³µ!');
                } else {
                    alert('ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                alert('ë¡œê·¸ì¸ ì˜¤ë¥˜: ' + error.message);
            }
        }

        async function register() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;

            if (!name || !email || !password) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                const response = await fetch(`${getBaseUrl()}/api/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password })
                });

                const data = await response.json();
                showResponse('registerResponse', data, !response.ok);

                if (response.ok) {
                    alert('íšŒì›ê°€ì… ì„±ê³µ! ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                    document.getElementById('loginEmail').value = email;
                    document.getElementById('loginPassword').value = password;
                }
            } catch (error) {
                showError('registerResponse', error.message);
            }
        }

        function logout() {
            accessToken = null;
            refreshToken = null;
            currentUser = null;
            updateAuthUI();
        }

        function updateAuthUI() {
            const authStatus = document.getElementById('authStatus');
            const loginForm = document.getElementById('loginForm');
            const loggedInInfo = document.getElementById('loggedInInfo');
            const userInfo = document.getElementById('userInfo');
            const tokenDisplay = document.getElementById('tokenDisplay');

            if (accessToken) {
                authStatus.textContent = 'ë¡œê·¸ì¸ë¨';
                authStatus.className = 'status-badge logged-in';
                loginForm.style.display = 'none';
                loggedInInfo.style.display = 'block';
                userInfo.textContent = `ë¡œê·¸ì¸: ${currentUser.email}`;
                tokenDisplay.textContent = `Token: ${accessToken.substring(0, 50)}...`;
            } else {
                authStatus.textContent = 'ë¡œê·¸ì•„ì›ƒ';
                authStatus.className = 'status-badge logged-out';
                loginForm.style.display = 'block';
                loggedInInfo.style.display = 'none';
            }
        }

        function getAuthHeaders() {
            if (!accessToken) {
                throw new Error('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            }
            return {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${accessToken}`
            };
        }

        async function getSites() {
            try {
                const response = await fetch(`${getBaseUrl()}/api/sites`, {
                    headers: getAuthHeaders()
                });

                const data = await response.json();
                showResponse('getSitesResponse', data, !response.ok);

                // ì²« ë²ˆì§¸ ì‚¬ì—…ì¥ì´ ìˆìœ¼ë©´ ë¶„ì„ í¼ì— ìë™ ì…ë ¥
                if (response.ok && data.sites && data.sites.length > 0) {
                    const site = data.sites[0];
                    document.getElementById('analysisSiteId').value = site.id;
                    document.getElementById('statusSiteId').value = site.id;
                }
            } catch (error) {
                showError('getSitesResponse', error.message);
            }
        }

        async function createSite() {
            try {
                const requestBody = {
                    name: document.getElementById('siteName').value,
                    roadAddress: document.getElementById('siteRoadAddr').value,
                    jibunAddress: document.getElementById('siteJibunAddr').value,
                    latitude: document.getElementById('siteLatitude').value,
                    longitude: document.getElementById('siteLongitude').value,
                    type: document.getElementById('siteType').value
                };

                const response = await fetch(`${getBaseUrl()}/api/sites`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();
                showResponse('createSiteResponse', data, !response.ok);

                if (response.ok) {
                    alert('ì‚¬ì—…ì¥ ìƒì„± ì„±ê³µ!');
                    // ìƒì„±ëœ ì‚¬ì—…ì¥ IDë¥¼ ë¶„ì„ í¼ì— ìë™ ì…ë ¥
                    document.getElementById('analysisSiteId').value = data.id;
                    document.getElementById('statusSiteId').value = data.id;
                    document.getElementById('analysisLatitude').value = data.latitude;
                    document.getElementById('analysisLongitude').value = data.longitude;
                }
            } catch (error) {
                showError('createSiteResponse', error.message);
            }
        }

        async function startAnalysis() {
            try {
                const siteId = document.getElementById('analysisSiteId').value;
                const requestBody = {
                    siteId: siteId,  // siteIdë¥¼ bodyì— í¬í•¨
                    latitude: document.getElementById('analysisLatitude').value,
                    longitude: document.getElementById('analysisLongitude').value,
                    industryType: document.getElementById('analysisIndustryType').value
                };

                const response = await fetch(`${getBaseUrl()}/api/analysis/start`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();
                showResponse('startAnalysisResponse', data, !response.ok);

                if (response.ok && data.jobId) {
                    document.getElementById('statusJobId').value = data.jobId;
                    alert('ë¶„ì„ ì‹œì‘! Job ID: ' + data.jobId);
                }
            } catch (error) {
                showError('startAnalysisResponse', error.message);
            }
        }

        async function getAnalysisStatus() {
            try {
                const siteId = document.getElementById('statusSiteId').value;
                const jobId = document.getElementById('statusJobId').value;

                // Query parametersë¡œ ë³€ê²½
                const response = await fetch(`${getBaseUrl()}/api/analysis/status?siteId=${siteId}&jobId=${jobId}`, {
                    headers: getAuthHeaders()
                });

                const data = await response.json();
                showResponse('analysisStatusResponse', data, !response.ok);
            } catch (error) {
                showError('analysisStatusResponse', error.message);
            }
        }

        function switchTab(tabName) {
            // ëª¨ë“  íƒ­ ë²„íŠ¼ê³¼ ì½˜í…ì¸  ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // ì„ íƒëœ íƒ­ í™œì„±í™”
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        function showRegisterForm() {
            switchTab('auth');
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // í˜„ì¬ í˜ì´ì§€ì˜ originì„ baseUrlë¡œ ì„¤ì •
            const currentOrigin = window.location.origin;
            document.getElementById('baseUrl').value = currentOrigin;
            updateAuthUI();
        });
    </script>
</body>
</html>
